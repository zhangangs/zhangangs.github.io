<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="apple-mobile-web-app-title" content="飞鱼"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f0f0f0"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="/manifest.json"><meta name="keywords" content="飞鱼,前端,技术博客,心情日记"><meta name="description" content="随手记录工作生活中的点点滴滴,让普通的生活中多一点小小的惊喜..."><title>thinkphp获取上一篇文章-飞鱼</title><link rel="apple-touch-icon" href="/images/android-chrome-192x192.png"><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"></head><body><div class="content"><div class="author-info post-header"><a href="/archives/" title="返回列表页"><img src="/images/icon_face.jpg"></a><a class="jump" href="/archives/" title="返回列表页"> <img src="/images/icon-back.svg"><span>返回</span></a></div><h4 class="post-title-wrapper"><p class="post-title">thinkphp获取上一篇文章</p></h4><div class="post-date"><p>Author:<a href="/about">飞鱼</a></p><p>Date:<time datetime="2017-05-11T16:00:00.000Z">2017-05-12</time></p></div><div class="post-content"><blockquote>
<p>这是博主在学习thinkphp的时候遇到的小问题，记录下来。</p>
</blockquote>
<p><strong>游览文章的时候，要显示上一篇下一篇功能，但是放进回收站的文章不能显示出来。(如果没有做回收站功能，那就不用这么麻烦)</strong></p>
<p>在<code>function.php</code> 中，添加一个方法，如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*获取没有放到回收站的上一篇文章Id */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPrevArticleId</span><span class="params">($id)</span></span>&#123;   </span><br><span class="line">    $db = M(<span class="string">'article'</span>);  </span><br><span class="line">    <span class="keyword">if</span>($id &lt;= <span class="number">0</span>)&#123;     </span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span>;   </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;             </span><br><span class="line">        <span class="keyword">for</span>($x=$id; $x&gt;<span class="number">0</span>; $x--)&#123;          </span><br><span class="line">            $res = $db-&gt;where(<span class="keyword">array</span>(<span class="string">'id'</span>=&gt;$x))-&gt;field(<span class="string">'id,display'</span>)-&gt;find();                 </span><br><span class="line">            <span class="keyword">if</span>($res[<span class="string">'display'</span>] != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//返回上一篇文章的id           </span></span><br><span class="line">            <span class="keyword">return</span> $res[<span class="string">'id'</span>];        </span><br><span class="line">        &#125;    </span><br><span class="line">      &#125;          </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>调用如下：</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前文章的id</span></span><br><span class="line">$id = I(<span class="string">'id'</span>);     </span><br><span class="line">$db =  M(<span class="string">'article'</span>);</span><br><span class="line"><span class="comment">//上一篇文章Id，等于当前文章id减1，这是假设这篇文章没有放进回收站</span></span><br><span class="line">$prevId = getPrevArticleId($id - <span class="number">1</span>); </span><br><span class="line"> <span class="comment">//查询上一篇文章   </span></span><br><span class="line">$prev = $db-&gt;where(<span class="keyword">array</span>(<span class="string">'id'</span>=&gt;$prevId))-&gt;field(<span class="string">'id,title'</span>)-&gt;find();   </span><br><span class="line"><span class="comment">//分配到模版</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;assign(<span class="string">'prev '</span>, $prev);</span><br></pre></td></tr></table></figure></p>
<p>完成~</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/shinux/hexo-theme-adoubi" target="_blank">Adoubi</a> , Modify By <a href="https://github.com/zhangangs" target="_blank">Veiss</a>, Powered By Hexo.</div></div><script src="/common.js"></script></body></html>